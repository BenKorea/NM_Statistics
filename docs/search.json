[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "R-4.4.1-NM_Statistics",
    "section": "",
    "text": "Shinylive로 핵의학통계 웹페이지 구성하는 과정을 정리한 것입니다.\n\n\n\n\n\n\n\n1단계: Quarto Website 프로젝트 만들기\n\n\n\n\n\n\nRStudio/File 메뉴에서 New Project... 메뉴 선택\nNew Directory에 생성되도록 선택\nProject type은 Quarto Website를 선택\n상위폴더가 C:/Projects인지 확인 (=Global Options 사전 지정값)\nCreate a git repository: 체크 유지하여 버전관리 적용\nUse renv with this project: 체크 유지하여 패키지 독립관리 적용\nUse visual markdown editor: 체크 유지하여 wizwig 에디터 사용\nOpen in new session: 기존 프로젝트가 이미 열려있고, 같이 사용할려면 체크\n\n\n\n\n\n\n\nrecommeded project name\n\nR-4.4.1-NM_Statistics_Example\n\n\n\n\n\n\n\n\n2단계: 버전관리 제외대상 추가하기\n\n\n\n\n\n\n.gitignore 파일을 열어서 아래의 내용을 추가하여 git 버전관리에서 제외합니다.\n\n\n\n\n\n\n\n.gitignore\n\n.Rprofile\n*.Rproj\nrenv/\n\n\n\n\n\n\n\n\n3단계: shiny 패키지 설치하기\n\n\n\n\n\n\n\n\n\n\n\n\nR Console\n\nrenv::install(\"shiny\")\n\n\n\n\n\n\n\n\n4단계: development version shinylive 패키지 설치하기\n\n\n\n\n\n\nDevelopment version은 loading 속도가 개선되었으므로 사용해벌 가치가 있습니다.\npak 패키지를 먼저 설치합니다.\npak 패키지를 이용해서 posit 사의 development version shinylive 패키지를 설치합니다.\n\n\n\n\n\n\n\nR console\n\nrenv::install(\"pak\")\n\n\n\n\n\nR console\n\npak::pak(\"posit-dev/r-shinylive\")\n\n\n\n\n\n\n\n\n6단계: shinylive extension 설치하기\n\n\n\n\n\n\n\n\n\n\n\n\nR Terminal\n\nquarto add quarto-ext/shinylive\n\n\n\n\n\n\n\n\n7단계: output-dir 설정하기\n\n\n\n\n\n\n\n\n\n\n\n\n_quarto.yml\n\n  output-dir: docs\n\n\n\n\n\n\n\n\n8단계: filter 설정하기\n\n\n\n\n\n\n\n\n\n\n\n\n_quarto.yml\n\nfilters:\n  - shinylive\n\n\n\n\n\n\n\n\n9단계: shinylive 테스트\n\n\n\n\n\n\nPreview가 될 때가 있고 안될 때가 있습니다.\n원인은 아직 모르겠지만, 시간이 경과하면 되는 것 같으므로 일단 진행합니다.\n\n\n\n\n```{shinylive-r}\n#| label: histogram_example\n#| standalone: true\n#| viewerHeight: 500\n\n\nlibrary(shiny)\n\nui &lt;- fluidPage(\n  titlePanel(\"Hello Shiny!\"),\n  sidebarLayout(\n    sidebarPanel(\n      sliderInput(\n        inputId = \"bins\",\n        label = \"Number of bins:\",\n        min = 1,\n        max = 50,\n        value = 30\n      )\n    ),\n    mainPanel(\n      plotOutput(outputId = \"distPlot\")\n    )\n  )\n)\n\nserver &lt;- function(input, output) {\n  output$distPlot &lt;- renderPlot({\n    x &lt;- faithful$waiting\n    bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)\n    hist(x,\n         breaks = bins, col = \"#75AADB\", border = \"white\",\n         xlab = \"Waiting time to next eruption (in mins)\",\n         main = \"Histogram of waiting times\"\n    )\n  })\n}\n\nshinyApp(ui = ui, server = server)\n\n```\n\n\n\n\n\n\n10단계: 병원목록 API\n\n\n\n\n\n\n심평원에서 관리하고 있는 병원 목록을 API로 호출하고 DB화 합니다.\n이 코드는 필요시에 한번만 실행하도록 해야 하므로 shiny로 구현하지 않습니다.\n\n\n\n\nR console\n\nrenv::install(\"rjson\")\n\n\n\n\n\nR console\n\nrenv::install(\"httr\")\n\n\n\n\n\nR console\n\nrenv::install(\"plyr\")\n\n\n\n\n\nR console\n\nrenv::install(\"xlsx\")\n\n\n\n\n\n```{r}\n#| label: all_pageNo_call\n\nlibrary(rjson)\nlibrary(httr)\nlibrary(plyr)\nlibrary(xlsx)\n\n\ndownload_api_data &lt;- function(page_No) {\n  base_url &lt;- \"http://apis.data.go.kr/B551182/hospInfoServicev2\"\n  call_url &lt;- \"getHospBasisList\"\n  My_API_Key &lt;- \"DRwFWZ/jfi6551teJKgRhkKgC+XhcjobN+ccY2MQdF9yZdx8xL5Kn4IljljMCWGsl2ObEco/rm21r14CN7iG0g==\"  # 실제 API 키\n  params &lt;- list(\n    serviceKey = My_API_Key,\n    pageNo = page_No\n  )\n  \n  # API 호출\n  url &lt;- paste0(base_url, \"/\", call_url)\n  response &lt;- GET(url, query = params)\n\n  if (status_code(response) == 200) {\n    json_text &lt;- content(response, as = \"text\", encoding = \"UTF-8\")\n    data &lt;- fromJSON(json_text)\n    return(data)\n  } else {\n    print(paste(\"API 호출 실패:\", status_code(response)))\n    return(NULL)\n  }\n}\n\ndata_list_all &lt;- list()\ndata_frame &lt;- data.frame()\npage_No &lt;- 0\nwhile (TRUE) {\n  page_No &lt;- page_No + 1\n  data &lt;- download_api_data(page_No)\n  \n  if (is.null(data) || is.null(data$response$body$items$item)) {\n    message(\"데이터가 더 이상 없습니다. 마지막 페이지: \", page_No)\n    break\n  }\n  \n  data_list&lt;-data$response$body$items$item\n  data_list_all[[page_No]] &lt;- lapply(data_list, as.data.frame)  # 데이터를 리스트로 저장\n  print(page_No)\n}\n\ndata_frame &lt;- rbind.fill(do.call(c, data_list_all))\nwrite.xlsx(df, \"output.xlsx\", sheetName = \"Sheet1\", row.names = FALSE)\n\n```\n```{r}\n#| label: all_pageNo_call_with_for\nlibrary(rjson)\nlibrary(httr)\nlibrary(plyr)\nlibrary(xlsx)\n\n# API 데이터 호출 함수\ndownload_api_data &lt;- function(page_No) {\n  base_url &lt;- \"http://apis.data.go.kr/B551182/hospInfoServicev2\"\n  call_url &lt;- \"getHospBasisList\"\n  My_API_Key &lt;- \"DRwFWZ/jfi6551teJKgRhkKgC+XhcjobN+ccY2MQdF9yZdx8xL5Kn4IljljMCWGsl2ObEco/rm21r14CN7iG0g==\"  # 실제 API 키\n  params &lt;- list(\n    serviceKey = URLencode(My_API_Key),\n    pageNo = page_No\n  )\n  \n  # API 호출\n  url &lt;- paste0(base_url, \"/\", call_url)\n  response &lt;- GET(url, query = params)\n  \n  if (status_code(response) == 200) {\n    json_text &lt;- content(response, as = \"text\", encoding = \"UTF-8\")\n    data &lt;- fromJSON(json_text)\n    \n    # 데이터가 존재하는 경우 반환\n    if (!is.null(data$response$body$items$item)) {\n      return(data$response$body$items$item)\n    } else {\n      return(NULL)\n    }\n  } else {\n    print(paste(\"API 호출 실패:\", status_code(response), \"페이지:\", page_No))\n    return(NULL)\n  }\n}\n\n# 첫 페이지에서 총 페이지 수 확인\ninitial_data &lt;- download_api_data(1)\nif (!is.null(initial_data)) {\n  total_count &lt;- as.numeric(initial_data$response$body$totalCount)\n  items_per_page &lt;- as.numeric(initial_data$response$body$numOfRows)\n  total_pages &lt;- ceiling(total_count / items_per_page)\n} else {\n  stop(\"초기 데이터 호출 실패\")\n}\n\n# 데이터 저장 리스트 초기화\ndata_list_all &lt;- list()\n\n# for 문을 이용하여 모든 페이지 호출\nfor (page_No in 1:total_pages) {\n  data &lt;- download_api_data(page_No)\n  \n  if (!is.null(data)) {\n    data_list_all[[page_No]] &lt;- lapply(data, as.data.frame)  # 데이터를 리스트로 저장\n  }\n  \n  print(paste(\"페이지 처리 완료:\", page_No))\n}\n\n# 데이터 결합\ndata_frame &lt;- rbind.fill(do.call(c, data_list_all))\n\n# 엑셀로 저장\nwrite.xlsx(data_frame, \"output.xlsx\", sheetName = \"Sheet1\", row.names = FALSE)\n```"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site\n\n1 + 1\n\n[1] 2"
  }
]